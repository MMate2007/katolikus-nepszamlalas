<html lang="hu">

<head>
	<meta charset="UTF-8">
	<title>Népszámlálás katolikus szemmel</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

	<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<style>
		.badge.even-larger-badge {
			font-size: 1.1em;
		}
	</style>
</head>

<body>

	<div class="container">
		<div class="px-4 py-5 my-5 text-center">
			<h1 class="display-5 fw-bold text-body-emphasis">A népszámlálás és a<br /> katolikus egyházmegyék</h1>
			<div class="col-lg-6 mx-auto">
				<p class="lead mb-4">A népszámlálási adatok a Magyar Katolikus Egyházról és összetételéről is sokat
					mesél. Ám míg az adatok alapvetően vármegye szinten és települési szinten érhetőek el legkönnyebben,
					addig a katolikus egyháznak az a leghasznosabb, ha egyházmegyei szinten is elérhetőek és
					elemezhetőek az adatok. Ehhez kívánunk segítséget nyújtani ezzel az egyszerű felelülettel. Talán az
					adatokat nézegetve észrevehetünk leheséges összefüggéseket, ami segíthet a reflexióban.</p>

				<div class="alert alert-danger">Az oldal még kezdetleges fázisban van. Gyere vissza később. Vagy inkább
					gyere segíteni nekünk a <a href="https://github.com/borazslo/katolikus-nepszamlalas">githubon</a>.
				</div>

				<div class="alert alert-info">
					<h5>Mit jelentenek és mit nem jelentenek a számok?</h5>
					<p>Vegyünk egy példát: elváltak a Győri egyházmegyében.</p>
					<p>2001-ben a 30 891 elvált személy élt a Győri egyházmegye jelenlegi területén. 2022-ben pedig 53
						724. Ez közel 74%-os növekedés. A legnagyobb arányú növekedés az egyházmegyék között. Jaj. De
						darabszámban a Váci egyházmegyében sokkal nagyobb a különbség 2001 és 2022 között az elváltak
						létszámát illetően: több mint negyven ezer. Közben ha lakosság arányában nézzük, akkor a Győri
						egyházmegyében 2001-ben a lakosság 5,8%-a volt elvált. 2022-ben pedig már 9,6%. Ám ezzel még
						mindig nem érte utol a Győri egyházmegye lakossága az országos átlagot. Juhú. Vagyis, hiába a
						legnagyobb növekedés az elváltak számában, az elváltak arányában még mindig nagyon jó a Győri
						egyházmegye.</p>
					<p>Fontos még azt is látni, hogy 2022 és 2001 között minden bizonnyal nem 22 833 válás történt.
						Lehetett sokkal több válás, csak aztán elhunytak az elváltak. Vagy átköltöztek másik
						egyházmegyébe. De az is lehet, hogy sok elvált ember költözött az egyházmegye területére. És még
						megannyi magyarázat lehet. Ezek az adatok csak pillanatfelvételek!</p>
				</div>
			</div>
		</div>

		<div class="b-example-divider"></div>

		<div id="sections">
		
		</div>
		

		<div class="container">
			<div id="cb_dioceses" style="display: none;">
				<h2>Egyházmegyék kiválasztása</h2>
			</div>
			<div class=" text-nowrap alert alert-info" id="content">Adatok betöltését hamarosan kezdjük.</div>
		</div>
		<div class="b-example-divider"></div>

		<div class="container" id="cc1" style="display: none">
			<h2 class="chart-title">KSH adatok vizualizálva</h2>
			<p>A diagram a 2022-es százalékos adatokból készült. Amennyiben a jelmagyarázatnál a címkékre ráklikkel, akkor
				változtathatja az oszlopok láthatóságát</p>
			<canvas id="c1"></canvas>
		</div>

		<center><a href="https://github.com/borazslo/katolikus-nepszamlalas" class="btn btn-secondary">View on
				GitHub</a></center>


	<script src="sections/cards.js"></script>
		<script src="sections/Section.js"></script>
		<script src="sections/AreaSection.js"></script>

		<script>
			
			const c1 = document.getElementById('c1');
			var chart1 = null
			var sum = {};
			var colls = [];
			var dictionary = {};
			var fullData = []

			$(document).ready(async function () {

				$("#content").html("Adatok begyűjtése");
				await loadFullData();
				console.log(fullData);			
				await readDictionary()
				
    			 publishCheckboxes(fullData);

				publishAll();				
				
				areasection("relation-5635587");
				$("#areaSection .select").on("change", function() {
					areasection(this.value);
				});			
			    function areasection(areaId) {
					const areasection = new AreaSection(fullData, colls)
					areasection.setAreaId(areaId);
					areasection.publish()
				}

			});

			function publishCheckboxes(data) {
				document.getElementById("cb_dioceses").style.display = "block";
				$.each(data, function (key, value) {					
					$("#cb_dioceses").append(
						`<div class="form-check form-check-inline">
 	<input class="form-check-input" type="checkbox" value="" id="cb_dioceses_${value.osmid}" checked onclick="reRender()">
  	<label class="form-check-label" for="cb_dioceses_${value.osmid}">
    	${value.name}
  	</label>
 </div>`)
				})
			}

			function clearTable1() {
				$("myTable").remove()
			}

			function clearTable2() {
				$("myTable2").remove()
			}

			function clearAll() {
				clearTable1()
				clearTable2()
			}

			function reRender() {
				clearAll()
				publishAll()
			}


			function publishTable(data, header) {
				$("#content").removeClass('alert');
				$("#content").html("<h2>KSH adatok kategóriánként</h2>");
				$("#content").append("<!-- TABLE CONSTRUCTION--><table class='table table-striped' id='myTable'><!-- HEADING FORMATION --><thead><tr id='table_header' class='table-primary'><th >Egyházmegye</th></tr></thead><tbody></tbody></table>");


				$.each(header, function (key, value) {
					$("#table_header").append("<th class='w-25'>" + (value in dictionary ? (dictionary[value].name ? dictionary[value].name : dictionary[value]) : value) + "</th>");
				});
				$.each(data, function (key, value) {
					if (!document.getElementById(`cb_dioceses_${value.osmid}`).checked) return;
					var markup = '<tr class="child"><th scope="row text-nowrap"><span class="text-nowrap">' + value.name + '</span></th>';

					for (let i = 0; i < Object.keys(value.data).length; i++) {
						var tmp = value.data[Object.keys(value.data)[i]];
						markup += "<td class='text-nowrap'>";



						markup += '<span class="badge text-bg-primary even-larger-badge" title="2022-es KSH adat">' + tmp[2022].toLocaleString('hu-HU') + '</span>';
						var diff = (tmp[2022] - tmp[2001]) / tmp[2001] * 100;
						if (diff > 5) var color = "success";
						else if (diff < -5) var color = "danger";
						else var color = "info"
						markup += ' <span class="badge text-bg-' + color + ' even-larger-badge" title="Különbség a 2022-es és a 2001-es KSH adat között.">' + diff.toFixed(2) + '%</span>';

						var diff1 = (tmp[2011] - tmp[2001]) / tmp[2001] * 100;
						var diff2 = (tmp[2022] - tmp[2011]) / tmp[2011] * 100;
						markup += '<br/><span class="badge text-bg-secondary" title="2001-es KSH adat">' + tmp[2001].toLocaleString('hu-HU') + '</span>&nbsp;<span class="badge text-bg-secondary" title="2011-es KSH adat">' + tmp[2011].toLocaleString('hu-HU') + '</span>&nbsp;<span class="badge text-bg-light" title="Változás 2001 és 2011 között.">' + diff1.toFixed(2) + '%</span><span class="badge text-bg-light" title="Változás 2011 és 2022 között.">' + diff2.toFixed(2) + '%</span>';


						markup += "</td>";
					}

					markup += '</tr>';
					$('#myTable tbody').append(markup);

				});
			}


			function publishTable2(data, header) {
				$("#content").append("<h2>KSH adatok lakosság létszámához arányosítva százalékban</h2>");
				$("#content").append("<!-- TABLE CONSTRUCTION--><table class='table table-striped' id='myTable2'><!-- HEADING FORMATION --><thead><tr id='table_header2' class='table-primary'><th >Egyházmegye</th></tr></thead><tbody></tbody></table>");


				$.each(header, function (key, value) {
					$("#table_header2").append("<th class='w-25'>" + (value in dictionary ? (dictionary[value].name ? dictionary[value].name : dictionary[value]) : value) + "</th>");
				});
				$.each(data, function (key, value) {
					if (!document.getElementById(`cb_dioceses_${value.osmid}`).checked) return;
					var markup = '<tr class="child"><th scope="row text-nowrap"><span class="text-nowrap">' + value.name + '</span></th>';

					for (let i = 0; i < Object.keys(value.data).length; i++) {
						var tmpOrig = value.data[Object.keys(value.data)[i]];
						markup += "<td class='text-nowrap'>";

						var sum = value.data["NEME_SEX"];
						var tmp = {
							'2022': tmpOrig[2022] / sum[2022] * 100,
							'2011': tmpOrig[2011] / sum[2011] * 100,
							'2001': tmpOrig[2001] / sum[2001] * 100,
						};

						markup += '<span class="badge text-bg-primary even-larger-badge" title="Lakosság arányos 2022-es KSH adat">' + tmp[2022].toFixed(1) + '%</span>';
						var diff = (tmp[2022] - tmp[2001]);
						if (diff > 5) var color = "success";
						else if (diff < -5) var color = "danger";
						else var color = "info"
						markup += ' <span class="badge text-bg-' + color + ' even-larger-badge" title="A 2022-es és a 2001-es lakosságarányos KSH adat közötti különbség (és nem százalék!)">' + diff.toFixed(1) + '</span>';

						var diff1 = (tmp[2011] - tmp[2001]);
						var diff2 = (tmp[2022] - tmp[2011]);
						markup += '<br/><span class="badge text-bg-secondary" title="2001-es KSH adat">' + tmp[2001].toFixed(1).toLocaleString('hu-HU') + '%</span>&nbsp;<span class="badge text-bg-secondary" title="2011-es KSH adat">' + tmp[2011].toFixed(1).toLocaleString('hu-HU') + '%</span>&nbsp;<span class="badge text-bg-light" title="Változás 2001 és 2011 között.">' + diff1.toFixed(1) + '</span><span class="badge text-bg-light" title="Változás 2011 és 2022 között.">' + diff2.toFixed(1) + '</span>';


						markup += "</td>";
					}

					markup += '</tr>';
					$('#myTable2 tbody').append(markup);

				});
			}

			function publishAll() {	
				publishTable(fullData, colls)
				publishTable2(fullData, colls)
				// generateChart(fullData, colls, c1)
			}
			

			async function loadFullData() {
				await $.getJSON("fullData.json", function (data) {
					for (const [key, value] of Object.entries(data[Object.keys(data)[0]]['data'])) {						
							colls.push(key);
					}
  					fullData = data					
				});				
			}

			async function readDictionary() {
				await $.getJSON("KSH DataSources/dictionary.json", function (data) {
					dictionary = data
				});
			}

			function generateChart(fullData, colls, chart) {
				if (chart1) chart1.destroy()
				document.getElementById("cc1").style.display = "block"
				filteredData = fullData.filter(d => document.getElementById(`cb_dioceses_${d.osmid}`).checked)
				chart1 = new Chart(chart, {
					type: "bar",
					data: {
						labels: filteredData.map(d => d.name),
						datasets: colls.filter(c => c != "NEME_SEX").map(c => {
							return {
								label: dictionary[c] ? (dictionary[c].name ? dictionary[c].name : dictionary[c]) : "Ismeretlen",
								data: filteredData.map(d => (d.data[c]["2022"] / d.data["NEME_SEX"]["2022"]) * 100),
								hidden: dictionary[c] ? (dictionary[c].hiddenInChart ? true : false) : false
							}
						})
					}
				})
			}

		</script>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
			crossorigin="anonymous"></script>

</body>

</html>